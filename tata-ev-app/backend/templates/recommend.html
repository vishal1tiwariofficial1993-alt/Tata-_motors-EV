<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Recommender - Tata Motors</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span>üîã Tata EV Platform</span>
            </div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/recommend">Recommend</a></li>
                <li><a href="/chargers">Chargers</a></li>
                <li><a href="/chat">Chat</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section class="page-section">
            <h1>ü§ñ AI-Powered EV Recommender</h1>
            <p class="subtitle">Tell us about your needs, and our AI will recommend the perfect Tata EV for you.</p>

            <!-- Recommendation Form -->
            <div class="form-card">
                <h2>Your Driving Profile</h2>
                <form id="recommendForm">
                    <div class="form-group">
                        <label for="dailyKm">Daily Driving Distance (km)</label>
                        <input type="number" id="dailyKm" name="dailyKm" min="10" max="500" value="50" required>
                        <small>How many kilometers do you drive on average per day?</small>
                    </div>

                    <div class="form-group">
                        <label for="usageType">Primary Usage Type</label>
                        <select id="usageType" name="usageType" required>
                            <option value="city">üèôÔ∏è City Driving</option>
                            <option value="highway">üõ£Ô∏è Highway Driving</option>
                            <option value="mix">üîÑ Mix of City & Highway</option>
                        </select>
                        <small>How do you primarily use your vehicle?</small>
                    </div>

                    <div class="form-group">
                        <label for="budget">Budget (‚Çπ)</label>
                        <input type="number" id="budget" name="budget" min="500000" max="5000000" value="1500000" step="100000" required>
                        <small>What's your budget range?</small>
                        <div class="budget-display">‚Çπ<span id="budgetDisplay">15,00,000</span></div>
                    </div>

                    <div class="form-group">
                        <label for="chargingAccess">Charging Access</label>
                        <select id="chargingAccess" name="chargingAccess" required>
                            <option value="home">üè† Home Charging</option>
                            <option value="public">‚ö° Public Charging</option>
                            <option value="both">üîå Both Home & Public</option>
                        </select>
                        <small>Where can you charge your EV?</small>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">Get Recommendation</button>
                </form>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section" style="display: none;">
                <h2>Your Personalized Recommendation</h2>
                
                <div class="recommendation-card">
                    <div class="recommendation-main">
                        <h3 id="recommendedModel"></h3>
                        <div class="recommendation-details">
                            <div class="detail-item">
                                <span class="label">Price Range:</span>
                                <span id="modelPrice" class="value"></span>
                            </div>
                            <div class="detail-item">
                                <span class="label">Range:</span>
                                <span id="modelRange" class="value"></span>
                            </div>
                            <div class="detail-item">
                                <span class="label">Charging Time (AC):</span>
                                <span id="modelChargeTime" class="value"></span>
                            </div>
                            <div class="detail-item">
                                <span class="label">Best For:</span>
                                <span id="modelBestFor" class="value"></span>
                            </div>
                        </div>
                    </div>

                    <div class="recommendation-reasoning">
                        <h4>Why This Model?</h4>
                        <p id="reasoningText"></p>
                    </div>

                    <div class="ai-insight">
                        <h4>ü§ñ AI Insight</h4>
                        <p id="aiInsight"></p>
                    </div>
                </div>

                <!-- Alternative Models -->
                <div class="alternatives-section">
                    <h3>Other Great Options</h3>
                    <div class="alternatives-grid" id="alternativesGrid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="next-steps">
                    <h3>What's Next?</h3>
                    <div class="steps-grid">
                        <div class="step">
                            <div class="step-number">1</div>
                            <h4>Check Real-World Range</h4>
                            <p>See how range changes with your driving conditions</p>
                            <a href="/templates/range.html" class="btn btn-small">Simulate Range ‚Üí</a>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <h4>Compare Costs</h4>
                            <p>Calculate savings vs petrol vehicles</p>
                            <a href="/templates/compare.html" class="btn btn-small">Compare Costs ‚Üí</a>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <h4>Book Test Drive</h4>
                            <p>Experience the EV firsthand</p>
                            <a href="/templates/testdrive.html" class="btn btn-small">Book Now ‚Üí</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Tata Motors EV Platform. All rights reserved.</p>
    </footer>

    <script src="/static/js/main.js"></script>
    <script>
        // Update budget display
        document.getElementById('budget').addEventListener('input', function() {
            const value = parseInt(this.value);
            document.getElementById('budgetDisplay').textContent = (value / 100000).toFixed(2) + ' L';
        });

        // Handle form submission
        document.getElementById('recommendForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                daily_km: parseInt(document.getElementById('dailyKm').value),
                usage_type: document.getElementById('usageType').value,
                budget: parseInt(document.getElementById('budget').value),
                charging_access: document.getElementById('chargingAccess').value
            };

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    displayRecommendation(data);
                    document.getElementById('resultsSection').style.display = 'block';
                    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error getting recommendation: ' + error);
            }
        });

        function displayRecommendation(data) {
            const rec = data.recommended_model;
            document.getElementById('recommendedModel').textContent = rec.name;
            document.getElementById('modelPrice').textContent = '‚Çπ' + (rec.base_price / 100000).toFixed(1) + ' L';
            document.getElementById('modelRange').textContent = rec.range_km + ' km';
            document.getElementById('modelChargeTime').textContent = rec.charging_time.ac_7kw + ' hours';
            document.getElementById('modelBestFor').textContent = rec.best_for.join(', ');
            document.getElementById('reasoningText').textContent = data.reasoning;
            document.getElementById('aiInsight').textContent = data.ai_insight;

            // Display alternatives
            const altGrid = document.getElementById('alternativesGrid');
            altGrid.innerHTML = '';
            if (data.alternatives) {
                data.alternatives.forEach(model => {
                    altGrid.innerHTML += `
                        <div class="alt-model-card">
                            <h4>${model.name}</h4>
                            <p>‚Çπ${(model.base_price/100000).toFixed(1)}L</p>
                            <p>${model.range_km}km Range</p>
                        </div>
                    `;
                });
            }
        }
    </script>
</body>
</html>
